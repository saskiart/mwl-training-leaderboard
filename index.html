<!DOCTYPE html>
<html>
<!-- Previous head and style sections remain the same -->
<head>
    <title>MANAGING WITHIN THE LAW - US GAME SHOW EDITION</title>
    <style>
        /* All previous styles remain the same */
    </style>
</head>
<body>
    <!-- Previous HTML structure remains the same until the script section -->
    
    <script>
        // JSONBin.io configuration
        const JSONBIN_BIN_ID = '6831ed698960c979a5a09182';
        const JSONBIN_API_KEY = '$2a$10$az3EVReenqC2VS1Obky5Cuph1T2/9Md5SJf2jT7k12EGB8FebuuKS';
        const JSONBIN_API_URL = 'https://api.jsonbin.io/v3/b';

        // Initialize or load scores
        async function initializeScores() {
            try {
                const response = await fetch(`${JSONBIN_API_URL}/${JSONBIN_BIN_ID}/latest`, {
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch scores');
                }
                
                const data = await response.json();
                return data.record;
            } catch (error) {
                console.error('Error loading scores:', error);
                // Fallback to empty scores if API call fails
                return {
                    overall: [],
                    hiring: [],
                    wage: [],
                    performance: [],
                    terminations: [],
                    claims: [],
                    policies: []
                };
            }
        }

        // Save scores to JSONBin.io
        async function saveScores(scores) {
            try {
                const response = await fetch(`${JSONBIN_API_URL}/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(scores)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save scores');
                }
                
                return true;
            } catch (error) {
                console.error('Error saving scores:', error);
                return false;
            }
        }

        // Toggle admin panel visibility
        function toggleAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            const modalBackdrop = document.getElementById('modalBackdrop');
            const isVisible = adminPanel.style.display === 'block';
            
            adminPanel.style.display = isVisible ? 'none' : 'block';
            modalBackdrop.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                populateResetCategorySelect();
            }
        }

        // Close admin panel when clicking outside
        document.getElementById('modalBackdrop').addEventListener('click', function(e) {
            if (e.target === this) {
                toggleAdminPanel();
            }
        });

        // Populate category select dropdown
        function populateResetCategorySelect() {
            const select = document.getElementById('resetCategorySelect');
            select.innerHTML = `
                <option value="">Select Category to Reset</option>
                <option value="hiring">üë• Hiring</option>
                <option value="wage">üí∞ Wage & Hour</option>
                <option value="performance">üìä Performance Management</option>
                <option value="terminations">üìù Terminations</option>
                <option value="claims">‚öñÔ∏è Common Claims</option>
                <option value="policies">üìú Key Policies</option>
            `;
        }

        // Add a new score
        async function addScore() {
            const category = document.getElementById('categorySelect').value;
            const playerName = document.getElementById('playerName').value;
            const score = parseInt(document.getElementById('score').value);
            const time = document.getElementById('time').value;

            if (!playerName || isNaN(score)) {
                alert('Please enter both name and score');
                return;
            }

            // Load current scores
            const scores = await initializeScores();
            
            // Add new score
            scores[category].push({
                name: playerName,
                score: score,
                time: time || 'N/A'
            });

            // Sort by score (descending)
            scores[category].sort((a, b) => b.score - a.score);

            // Save updated scores
            const saved = await saveScores(scores);
            if (saved) {
                // Play submit sound
                document.getElementById('submitSound').play();

                updateLeaderboards();
                
                // Clear form
                document.getElementById('playerName').value = '';
                document.getElementById('score').value = '';
                document.getElementById('time').value = '';
            } else {
                alert('Failed to save score. Please try again.');
            }
        }

        // Celebration effects
        function celebrateNewHighScore() {
            // Play celebration sound
            document.getElementById('celebrationSound').play();

            // Add celebration animation to the leaderboard
            const leaderboard = document.querySelector('.leaderboard');
            leaderboard.classList.add('celebrate');
            setTimeout(() => leaderboard.classList.remove('celebrate'), 500);

            // Create confetti
            createConfetti();
        }

        function createConfetti() {
            const colors = ['#e67e22', '#2d6898', '#1a4b6e', '#ffc107', '#fff'];
            const confettiCount = 100;
            const container = document.querySelector('.confetti-container');
            container.innerHTML = '';

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animation = 'confetti 3s ease-out forwards';
                container.appendChild(confetti);
            }

            // Clean up confetti after animation
            setTimeout(() => {
                container.innerHTML = '';
            }, 6000);
        }

        // Reset all scores
        async function confirmResetAll() {
            if (confirm('Are you sure you want to reset ALL scores? This cannot be undone.')) {
                const emptyScores = {
                    overall: [],
                    hiring: [],
                    wage: [],
                    performance: [],
                    terminations: [],
                    claims: [],
                    policies: []
                };
                
                const saved = await saveScores(emptyScores);
                if (saved) {
                    updateLeaderboards();
                    alert('All scores have been reset');
                } else {
                    alert('Failed to reset scores. Please try again.');
                }
            }
        }

        // Reset specific category
        async function confirmResetCategory() {
            const category = document.getElementById('resetCategorySelect').value;
            if (!category) {
                alert('Please select a category to reset');
                return;
            }

            if (confirm(`Are you sure you want to reset scores for ${category}? This cannot be undone.`)) {
                const scores = await initializeScores();
                scores[category] = [];
                
                const saved = await saveScores(scores);
                if (saved) {
                    updateLeaderboards();
                    alert(`Scores for ${category} have been reset`);
                } else {
                    alert('Failed to reset category. Please try again.');
                }
            }
        }

        // Update specific category leaderboard
        function updateCategoryLeaderboard(tableId, scores) {
            const tbody = document.getElementById(tableId);
            tbody.innerHTML = '';

            scores.forEach((score, index) => {
                const row = tbody.insertRow();
                const rankCell = row.insertCell();
                const medal = getMedalEmoji(index);
                rankCell.innerHTML = medal ? medal : (index + 1);
                rankCell.className = medal ? 'medal-rank' : '';
                
                row.innerHTML += `
                    <td>${score.name}</td>
                    <td>${score.score}</td>
                    <td>${score.time}</td>
                `;
            });
        }

        // Update overall leaderboard
        function updateOverallLeaderboard(scores) {
            const tbody = document.getElementById('overallLeaderboard');
            tbody.innerHTML = '';

            // Calculate total scores for each player
            const playerTotals = {};
            const categories = ['hiring', 'wage', 'performance', 'terminations', 'claims', 'policies'];

            categories.forEach(category => {
                scores[category].forEach(score => {
                    if (!playerTotals[score.name]) {
                        playerTotals[score.name] = {
                            totalScore: 0,
                            categoriesCompleted: 0
                        };
                    }
                    playerTotals[score.name].totalScore += score.score;
                    playerTotals[score.name].categoriesCompleted += 1;
                });
            });

            // Convert to array and sort
            const sortedPlayers = Object.entries(playerTotals)
                .map(([name, data]) => ({
                    name,
                    totalScore: data.totalScore,
                    categoriesCompleted: data.categoriesCompleted
                }))
                .sort((a, b) => b.totalScore - a.totalScore);

            // Update table
            sortedPlayers.forEach((player, index) => {
                const row = tbody.insertRow();
                const rankCell = row.insertCell();
                const medal = getMedalEmoji(index);
                rankCell.innerHTML = medal ? medal : (index + 1);
                rankCell.className = medal ? 'medal-rank' : '';
                
                row.innerHTML += `
                    <td>${player.name}</td>
                    <td>${player.totalScore}</td>
                    <td>${player.categoriesCompleted} / 6</td>
                `;
            });
        }

        // Get medal emoji based on rank
        function getMedalEmoji(index) {
            switch(index) {
                case 0: return 'ü•á';
                case 1: return 'ü•à';
                case 2: return 'ü•â';
                default: return null;
            }
        }

        // Update all leaderboards
        async function updateLeaderboards() {
            const scores = await initializeScores();
            
            // Update each category leaderboard
            updateCategoryLeaderboard('hiringLeaderboard', scores.hiring);
            updateCategoryLeaderboard('wageLeaderboard', scores.wage);
            updateCategoryLeaderboard('performanceLeaderboard', scores.performance);
            updateCategoryLeaderboard('terminationsLeaderboard', scores.terminations);
            updateCategoryLeaderboard('claimsLeaderboard', scores.claims);
            updateCategoryLeaderboard('policiesLeaderboard', scores.policies);
            
            // Update overall leaderboard
            updateOverallLeaderboard(scores);
        }

        // Auto-refresh leaderboard every 30 seconds
        setInterval(updateLeaderboards, 30000);

        // Initial update of leaderboards
        updateLeaderboards();
    </script>
</body>
</html>